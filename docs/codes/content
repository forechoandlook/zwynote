è®°å¿†ç®¡ç†å±‚ï¼ˆMemory Management Layerï¼‰

è®°å¿†æå–å™¨ï¼ˆMemory Extractorï¼‰ï¼šä»å¯¹è¯ä¸­è¯†åˆ«å’Œæå–å…³é”®ä¿¡æ¯
è®°å¿†æ›´æ–°å™¨ï¼ˆMemory Updaterï¼‰ï¼šå¤„ç†è®°å¿†çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
å†²çªè§£å†³å™¨ï¼ˆConflict Resolverï¼‰ï¼šå¤„ç†è®°å¿†ä¿¡æ¯çš„å†²çªå’Œæ›´æ–°

å­˜å‚¨æŠ½è±¡å±‚ï¼ˆStorage Abstraction Layerï¼‰

ç»Ÿä¸€çš„å­˜å‚¨æ¥å£ï¼Œæ”¯æŒå¤šç§åç«¯å­˜å‚¨
è®°å¿†ç´¢å¼•ç®¡ç†
æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–


## ç³»ç»Ÿæ•´ä½“æ¶æ„æµç¨‹å›¾

```mermaid
graph TB
    A[ç”¨æˆ·è¾“å…¥å¯¹è¯æ–‡æœ¬] --> B[MemoryManager]
    B --> C[MemoryExtractor]
    C --> D[LLMåˆ†ææå–å…³é”®ä¿¡æ¯]
    D --> E{é‡è¦æ€§è¯„åˆ†>=5?}
    E -->|æ˜¯| F[VectorStoreå‘é‡åŒ–]
    E -->|å¦| G[ä¸¢å¼ƒè®°å¿†]
    F --> H[ç”Ÿæˆè®°å¿†ID]
    H --> I[åˆ›å»ºMemoryå¯¹è±¡]
    I --> J[MemoryDatabaseå­˜å‚¨]
    J --> K[ä¿å­˜åˆ°SQLite]
    
    L[ç”¨æˆ·æŸ¥è¯¢] --> M[MemoryManager]
    M --> N[VectorStoreæŸ¥è¯¢å‘é‡åŒ–]
    N --> O[ä»æ•°æ®åº“è·å–æ‰€æœ‰è®°å¿†]
    O --> P[è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦]
    P --> Q[è¿”å›Top-Kç›¸ä¼¼è®°å¿†]
    Q --> R[æ ¼å¼åŒ–ä¸Šä¸‹æ–‡]
    R --> S[è¿”å›ç»™ç”¨æˆ·]
```

## è®°å¿†æ·»åŠ è¯¦ç»†æµç¨‹

```mermaid
flowchart TD
    A["ğŸ“ è¾“å…¥å¯¹è¯æ–‡æœ¬"] --> B["ğŸ¤– MemoryExtractor"]
    B --> C["ğŸ’­ æ„å»ºæå–æç¤ºè¯"]
    C --> D["ğŸ”„ è°ƒç”¨GPT-3.5"]
    D --> E["ğŸ“Š è§£æJSONå“åº”"]
    E --> F{"âš–ï¸ é‡è¦æ€§>=5?"}
    F -->|"âœ… æ˜¯"| G["ğŸ”¢ ç”ŸæˆMD5è®°å¿†ID"]
    F -->|"âŒ å¦"| H["ğŸ—‘ï¸ ä¸¢å¼ƒè®°å¿†"]
    G --> I["ğŸ§® Ollamaå‘é‡åŒ–"]
    I --> J["ğŸ“¦ åˆ›å»ºMemoryå¯¹è±¡"]
    J --> K["ğŸ’¾ SQLiteå­˜å‚¨"]
    K --> L["âœ… ä¿å­˜å®Œæˆ"]
```


## è®°å¿†æ£€ç´¢è¯¦ç»†æµç¨‹

```mermaid
flowchart TD
    A["ğŸ” ç”¨æˆ·æŸ¥è¯¢"] --> B["ğŸ§® æŸ¥è¯¢æ–‡æœ¬å‘é‡åŒ–"]
    B --> C["ğŸ“š è·å–ç”¨æˆ·æ‰€æœ‰è®°å¿†"]
    C --> D["ğŸ”¢ æå–è®°å¿†å‘é‡"]
    D --> E["ğŸ“ è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦"]
    E --> F["ğŸ“Š ç›¸ä¼¼åº¦æ’åº"]
    F --> G["ğŸ¯ è¿”å›Top-Kè®°å¿†"]
    G --> H["ğŸ“ æ ¼å¼åŒ–ä¸Šä¸‹æ–‡"]
    H --> I["ğŸ“¤ è¿”å›ç»“æœ"]
```

## æ•°æ®åº“æ“ä½œæµç¨‹
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant MM as MemoryManager
    participant DB as MemoryDatabase
    participant SQLite as SQLiteæ•°æ®åº“
    
    U->>MM: æ·»åŠ è®°å¿†
    MM->>DB: save_memory()
    DB->>SQLite: INSERT OR REPLACE
    SQLite-->>DB: ç¡®è®¤ä¿å­˜
    DB-->>MM: ä¿å­˜æˆåŠŸ
    MM-->>U: è®°å¿†å·²ä¿å­˜
    
    U->>MM: æŸ¥è¯¢è®°å¿†
    MM->>DB: get_memories()
    DB->>SQLite: SELECTæŸ¥è¯¢
    SQLite-->>DB: è¿”å›è®°å¿†åˆ—è¡¨
    DB-->>MM: Memoryå¯¹è±¡åˆ—è¡¨
    MM-->>U: æ ¼å¼åŒ–ç»“æœ
```

## æ ¸å¿ƒç»„ä»¶äº¤äº’å›¾
```mermaid
graph LR
    subgraph "è®°å¿†ç®¡ç†ç³»ç»Ÿ"
        A[MemoryManager<br/>æ ¸å¿ƒæ§åˆ¶å™¨] 
        B[MemoryExtractor<br/>æ™ºèƒ½æå–]
        C[VectorStore<br/>å‘é‡å¤„ç†]
        D[MemoryDatabase<br/>æ•°æ®å­˜å‚¨]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        E[OpenAI GPT-3.5<br/>æ–‡æœ¬åˆ†æ]
        F[Ollama<br/>å‘é‡åµŒå…¥]
        G[SQLite<br/>æŒä¹…åŒ–å­˜å‚¨]
    end
    
    A --> B
    A --> C
    A --> D
    B --> E
    C --> F
    D --> G
```